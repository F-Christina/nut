syntax_version: "5"
project_name: nut
based_on:
  github: matthieudelaro/nutfile_go1.6
container_working_directory: /go/src/github.com/matthieudelaro/nut
mount:
  main: # mount current directory
  - .
  - /go/src/github.com/matthieudelaro/nut
  dockersock: # mount docker socket run nut in a container
  - /var/run/docker.sock
  - /var/run/docker.sock
macros:
  code:
    usage: open this project in vscode
    docker_image: ctaggart/golang-vscode
    enable_gui: true
    security_opts:
    - seccomp=unconfined
    actions:
    # symlink workaround for vendor directory
    # using vendor/src would be GOPATH compatible and remove the need for the symlink
    - cmd='
      nut=/go/src/github.com/matthieudelaro/nut;
      rm -f $nut/src;
      ln -s $nut/vendor $nut/src;
      export GOPATH=/go:$nut;
      code -w $nut'
    - su - vscode -c "$cmd"
